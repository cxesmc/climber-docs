<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../img/favicon.ico" />
    <title>runme notes - CLIMBER-X-docs</title>
    <link rel="stylesheet" href="../css/theme.css" />
    <link rel="stylesheet" href="../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
        <link href="../stylesheets/extra.css" rel="stylesheet" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "runme notes";
        var mkdocs_page_input_path = "runme-notes.md";
        var mkdocs_page_url = null;
      </script>
    
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
      <script>hljs.highlightAll();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href=".." class="icon icon-home"> CLIMBER-X-docs
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="..">Home</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">Getting started</span></p>
              <ul class="current">
                  <li class="toctree-l1"><a class="reference internal" href="../getting-started/">Getting started</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../dependencies/">Dependencies</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../installation/">Installation</a>
                  </li>
                  <li class="toctree-l1 current"><a class="reference internal current" href="./">runme notes</a>
    <ul class="current">
    <li class="toctree-l2"><a class="reference internal" href="#general-steps-to-prepare-a-simulation">General steps to prepare a simulation</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#using-runme-for-one-simulation">Using runme for one simulation</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#using-runme-with-jobrun-for-ensembles">Using runme with jobrun for ensembles</a>
    </li>
    </ul>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Use cases</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../use-cases/01-pi_spinup/">Pre-industrial spinup</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../use-cases/02-historical/">Historical</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Output description</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../var_lists/">Output files</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Workshops</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../workshops/2025/">Workshop 2025</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="..">CLIMBER-X-docs</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href=".." class="icon icon-home" aria-label="Docs"></a></li>
          <li class="breadcrumb-item">Getting started</li>
      <li class="breadcrumb-item active">runme notes</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="running-climber-x-with-runme">Running CLIMBER-X with <code>runme</code></h1>
<h2 id="general-steps-to-prepare-a-simulation">General steps to prepare a simulation</h2>
<p>After <strong>CLIMBER-X</strong> has been compiled, several steps must be completed to run the executable <code>climber.x</code>:</p>
<ol>
<li>Create a run directory (<code>RUNDIR</code>).</li>
<li>Copy namelist parameter files to <code>RUNDIR</code>.</li>
<li>Make links to the <code>input</code>, <code>maps</code> and <code>restart</code> directories in <code>RUNDIR</code>.</li>
<li>Copy <code>VILMA</code> restart files to <code>RUNDIR</code> (since these are eventually modified by <code>climber.x</code>).</li>
<li>Copy the executable file <code>climber.x</code> to <code>RUNDIR</code>.</li>
<li>To run on the cluster, create a job submission script (e.g. <code>job.submit</code>) in <code>RUNDIR</code> to manage various computing options (number of processors, etc).</li>
</ol>
<p>When these steps are completed, <code>climber.x</code> should be run directly from <code>RUNDIR</code> using the job submission script. E.g., using SLURM:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nb">cd</span><span class="w"> </span>RUNDIR
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>sbatch<span class="w"> </span>job.submit
</span></code></pre></div>
<p>If not using the cluster, <strong>CLIMBER-X</strong> can also be run manually by entering the <code>RUNDIR</code> and running the following:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a><span class="nb">cd</span><span class="w"> </span>RUNDIR
</span><span id="__span-1-2"><a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a>./climber.x<span class="w"> </span>&gt;<span class="w"> </span>out.out
</span></code></pre></div>
<p>Either of the above will run climber in <code>RUNDIR</code> with all simulation output stored in the same directory. Because the directory includes the executable and is self-contained, assuming the contents of the linked directories do not change, the simulation can be re-run at any time.</p>
<p>To perform all of the above steps manually for multiple simulations is very tedious and time-consuming, so a "run" script called <code>runme</code> is used to handle the process.</p>
<h2 id="using-runme-for-one-simulation">Using <code>runme</code> for one simulation</h2>
<p>Before using <code>runme</code>, the user should store a configuration file with some personal choices. To get started, copy the template config file to the main directory:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a>cp<span class="w"> </span>.runme/runme_config<span class="w"> </span>.runme_config
</span></code></pre></div>
<p>Next edit <code>.runme_config</code> so that the choices match your configuration. Mostly, this means setting <code>hpc</code> to the name of your current system and <code>account</code> to the default account to be used for your jobs submitted via SLURM. Also you can add your email address if you would like to receive notifications from SLURM about your jobs.</p>
<p>Now <code>runme</code> is ready for use. See <code>./runme -h</code> for details on possible arguments.</p>
<p>Note that aside from possible optional arguments, <code>runme</code> is always called with the required argument <code>-o RUNDIR</code> that specifies the output directory. So, to run a <code>climber.x</code> simulation as a job on the cluster in <code>RUNDIR</code>, run the command:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-3-1"><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a>./runme<span class="w"> </span>-rs<span class="w"> </span>-o<span class="w"> </span>RUNDIR
</span></code></pre></div>
<p>where <code>RUNDIR</code> is the desired run directory. The option <code>-r</code> says that the job should actually be run (instead of just prepared) and <code>-s</code> specifies that the job should be run on the cluster. If <code>-r</code> is used alone, then the job is simply run as a background process. Other options include <code>-q, --queue</code> for the queue alias (short, priority, etc.), <code>-w, --wall</code> for the maximum wall clock time to allow in format HH:MM:SS, <code>--part</code> to name the processor partition (priority, standard, smp, etc), <code>--omp</code> to specify the number of processors, and others. See <code>./runme -h</code> for all options.</p>
<p>When called as above, this script will run a simulation using the parameters as they are specified in the namelist parameter files in the <code>nml</code> directory. In addition, it is possible to modify the parameters of one simulation at the command line using the argument <code>-p KEY=VAL KEY=VAL ...</code>. So, for example, the following command:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-4-1"><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a>./runme<span class="w"> </span>-s<span class="w"> </span>-o<span class="w"> </span>RUNDIR<span class="w"> </span>-p<span class="w"> </span>ctl.n_accel<span class="o">=</span><span class="m">10</span>
</span></code></pre></div>
<p>will run <code>climber.x</code> on the cluster in the output directory <code>RUNDIR</code> with the control parameter <code>control.n_accel</code> set to <code>10</code>. Note that <code>ctl</code> is a convenient alias for the namelist group <code>control</code>, as defined in <code>.runme/climberx_info.json</code>.</p>
<p>To perform a simulation an ensemble of simulations with modified parameter values, <code>runme</code> should be called via <code>jobrun</code> (see below).</p>
<h2 id="using-runme-with-jobrun-for-ensembles">Using <code>runme</code> with <code>jobrun</code> for ensembles</h2>
<p><code>jobrun</code> is a command that is part of the FESMC <code>runner</code> library (Python package). This command facilitates running ensembles of simulations, or simulations with modified parameters via a convenient command-line interface. See <a href="../dependencies/">Dependencies</a> for its installation instructions.</p>
<p>Using <code>jobrun</code>, the following command would produce the same simulation as <code>./runme -s RUNDIR</code>:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-5-1"><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a>jobrun<span class="w"> </span>./runme<span class="w"> </span>-rs<span class="w"> </span>-o<span class="w"> </span>OUTDIR
</span></code></pre></div>
<p>The difference here is that now we don't specify the specific <code>RUNDIR</code>, but rather an encapsulating <code>OUTDIR</code> that will contain one or more <code>RUNDIR</code>'s. In the above example, no parameters are changed, so the simulation is saved in the <code>default</code> directory: <code>OUTDIR/default</code>.</p>
<p>If we want to change a parameter, this can be done as with the <code>runme</code> script via the <code>-p</code> option:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-6-1"><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a>jobrun<span class="w"> </span>./runme<span class="w"> </span>-rs<span class="w"> </span>-o<span class="w"> </span>OUTDIR<span class="w"> </span>-p<span class="w"> </span>ctl.n_accel<span class="o">=</span><span class="m">10</span>
</span></code></pre></div>
<p>This will produce one simulation with the parameter <code>control.n_accel=10</code>. Since we have changed a parameter for this simulation, <code>jobrun</code> treats this as an ensemble, so the output is saved in <code>OUTDIR/0</code> for simulation 0. In short, the above command is equivalent to <code>./runme -s -o OUTDIR -p ctl.n_accel=10</code>, but in the former case, the output is stored in <code>OUTDIR/0</code> and in the latter case, it is stored directly in <code>OUTDIR</code>.</p>
<p>The power of <code>jobrun</code> comes when we want to run an ensemble:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-7-1"><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a>jobrun<span class="w"> </span>./runme<span class="w"> </span>-rs<span class="w"> </span>-o<span class="w"> </span>OUTDIR<span class="w"> </span>-p<span class="w"> </span>ctl.n_accel<span class="o">=</span><span class="m">1</span>,5,10
</span></code></pre></div>
<p>This ensemble of simulations will appear in <code>OUTDIR/0</code>, <code>OUTDIR/1</code> and <code>OUTDIR/2</code>, respectively.</p>
<p>A more informative output directory can be made using the option <code>-a</code> along with <code>-o</code>:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-8-1"><a id="__codelineno-8-1" name="__codelineno-8-1" href="#__codelineno-8-1"></a>jobrun<span class="w"> </span>./runme<span class="w"> </span>-rs<span class="w"> </span>-a<span class="w"> </span>-o<span class="w"> </span>OUTDIR<span class="w"> </span>-p<span class="w"> </span>ctl.n_accel<span class="o">=</span><span class="m">1</span>,5,10
</span></code></pre></div>
<p>In this case, the run directories are <code>OUTDIR/ctl.nccl.1</code>, <code>OUTDIR/ctl.nccl.5</code> and <code>OUTDIR/ctl.nccl.10</code>, respectively.</p>
<p>General information about the ensemble can be found in the main ensemble directory <code>OUTDIR</code>:</p>
<ul>
<li><code>params.txt</code> : contains a table of the parameter combinations set on the command line (can be used to run a new ensemble).</li>
<li><code>info.txt</code> : the same parameter table as <code>params.txt</code>, but also including an index of the <code>runid</code> (0,1,2, etc) and the <code>RUNDIR</code>:</li>
</ul>
<p><code>info.txt</code>:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-9-1"><a id="__codelineno-9-1" name="__codelineno-9-1" href="#__codelineno-9-1"></a>  <span class="n">runid</span>    <span class="n">ctl</span><span class="o">.</span><span class="n">n_accel</span>  <span class="n">rundir</span>
</span><span id="__span-9-2"><a id="__codelineno-9-2" name="__codelineno-9-2" href="#__codelineno-9-2"></a>      <span class="mi">0</span>              <span class="mi">1</span>  <span class="n">ctl</span><span class="o">.</span><span class="n">nccl</span><span class="mf">.1</span>
</span><span id="__span-9-3"><a id="__codelineno-9-3" name="__codelineno-9-3" href="#__codelineno-9-3"></a>      <span class="mi">1</span>              <span class="mi">5</span>  <span class="n">ctl</span><span class="o">.</span><span class="n">nccl</span><span class="mf">.5</span>
</span><span id="__span-9-4"><a id="__codelineno-9-4" name="__codelineno-9-4" href="#__codelineno-9-4"></a>      <span class="mi">2</span>             <span class="mi">10</span>  <span class="n">ctl</span><span class="o">.</span><span class="n">nccl</span><span class="mf">.10</span>
</span></code></pre></div>
<p>It is of course possible to define multiple parameter permutations:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-10-1"><a id="__codelineno-10-1" name="__codelineno-10-1" href="#__codelineno-10-1"></a>jobrun<span class="w"> </span>./runme<span class="w"> </span>-rs<span class="w"> </span>-o<span class="w"> </span>OUTDIR<span class="w"> </span>-p<span class="w"> </span>ctl.n_accel<span class="o">=</span><span class="m">1</span>,5,10<span class="w"> </span>smb.alb_ice<span class="o">=</span><span class="m">0</span>.3,0.4
</span></code></pre></div>
<p>To generate a more complex ensemble, using e.g. Latin-Hypercube sampling, then a two step approach is often better. First, use the <code>runner</code> command <code>job sample</code> to build the ensemble, then use <code>jobrun</code> to run it:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-11-1"><a id="__codelineno-11-1" name="__codelineno-11-1" href="#__codelineno-11-1"></a><span class="c1"># Generate ensemble parameters</span>
</span><span id="__span-11-2"><a id="__codelineno-11-2" name="__codelineno-11-2" href="#__codelineno-11-2"></a>job<span class="w"> </span>sample<span class="w"> </span>-o<span class="w"> </span>lhs.txt<span class="w"> </span>--seed<span class="w"> </span><span class="m">4</span><span class="w"> </span>-N<span class="w"> </span><span class="m">100</span><span class="w"> </span>atm.c_trop_2<span class="o">=</span><span class="m">0</span>.8,1.2<span class="w"> </span>smb.alb_ice<span class="o">=</span><span class="m">0</span>.3,0.4
</span><span id="__span-11-3"><a id="__codelineno-11-3" name="__codelineno-11-3" href="#__codelineno-11-3"></a>
</span><span id="__span-11-4"><a id="__codelineno-11-4" name="__codelineno-11-4" href="#__codelineno-11-4"></a><span class="c1"># Run ensemble</span>
</span><span id="__span-11-5"><a id="__codelineno-11-5" name="__codelineno-11-5" href="#__codelineno-11-5"></a>jobrun<span class="w"> </span>./runme<span class="w"> </span>-rs<span class="w"> </span>-o<span class="w"> </span>OUTDIR<span class="w"> </span>-i<span class="w"> </span>lhs.txt
</span></code></pre></div>
<p>This two-step method facilitates checking that the ensemble was generated properly and improves reproducibility, since the exact parameter values are available in the table.</p>
              
            </div>
          </div><footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="Footer Navigation">
        <a href="../installation/" class="btn btn-neutral float-left" title="Installation"><span class="icon icon-circle-arrow-left"></span> Previous</a>
        <a href="../use-cases/01-pi_spinup/" class="btn btn-neutral float-right" title="Pre-industrial spinup">Next <span class="icon icon-circle-arrow-right"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
      <span><a href="../installation/" style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
      <span><a href="../use-cases/01-pi_spinup/" style="color: #fcfcfc">Next &raquo;</a></span>
    
  </span>
</div>
    <script src="../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "..";</script>
    <script src="../js/theme_extra.js"></script>
    <script src="../js/theme.js"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
      <script src="../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
